@model MultiselectViewModel
@{
    Layout = null;
}

<!--good, also for many multiple selects-->
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Multiselect</title>
    <link rel="stylesheet" href="~/css/site.css" />
</head>
<body>
    <form asp-action="Index">
        <div class="multiselect" id="vesseltypes">
            <div class="selectBox">
                <span id="arrowSel"></span>
                <span class="oryginalText">Select vessel types</span>
                <span>Select vessel types</span>
                <select asp-for="Types" class="inputSelect" id="selectvesseltypes" multiple>
                    @foreach (string item in ViewBag.VesselTypes)
                    {
                        <option>@item</option>
                    }
                </select>
                <div class="overSelect"></div>
            </div>
            <div class="checkboxes" id="checkboxesvesseltypes">

                @foreach (string item in ViewBag.VesselTypes)
                {
                <label for="@item">
                    <input type="checkbox" id="@item" onchange="addSelection(this)" />@item
                </label>
                }
            </div>
        </div>
        <div class="multiselect" id="vesselflags">
            <div class="selectBox">
                <span id="arrowSel"></span>
                <span class="oryginalText">Select flags</span>
                <span>Select flags</span>
                <select asp-for="Flags" class="inputSelect" id="selectvesselflags" multiple>
                    @foreach (string item in ViewBag.VesselFlags)
                    {
                        <option>@item</option>
                    }
                </select>
                <div class="overSelect"></div>
            </div>
            <div class="checkboxes" id="checkboxesvesselflags">
                @foreach (string item in ViewBag.VesselFlags)
                {
                    <label for="@item">
                        <input type="checkbox" id="@item" onchange="addSelection(this)" />@item
                    </label>
                }
            </div>
            </div>
        <input type="submit" value="Send" />
    </form>


    <script>
        function select(selection, checkbox, selectionId) {
            var sel = document.getElementById(selectionId);
            var opts = sel.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.value === checkbox.id) {
                    opt.selected = selection;
                    break;
                }
            }
            var counter = 0;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.selected === true) {
                    counter++;
                }
            }
            if (counter === 0) {
                sel.previousElementSibling.innerHTML = sel.previousElementSibling.previousElementSibling.innerHTML;
            }
            else {
                sel.previousElementSibling.innerHTML = 'Selected: ' + counter;
            }
        }

        //on checkbox change
        function addSelection(checkbox) {
            const checkboxes = checkbox.parentNode.parentNode.id;
            const selectionId = checkboxes.replace('checkboxes', 'select');

            if (checkbox.checked) {
                select(true, checkbox, selectionId);
            }
            else {
                select(false, checkbox, selectionId);
            }
        }

        //get all select tag objects
        const multiSelections = document.getElementsByClassName('multiselect');

        //on click of select tag object
        for (var multiSelect, j = 0; multiSelect = multiSelections[j]; j++) {
            const checkboxes = document.getElementById("checkboxes" + multiSelect.id);
            const multi = multiSelect;
            window.addEventListener('click', function (e) {
                if (multi.contains(e.target)) {
                    if (checkboxes.style.display === 'block') {
                        checkboxes.style.display = "none";
                    } else {
                        checkboxes.style.display = "block";
                    };
                }
                if (!checkboxes.contains(e.target) && !multi.contains(e.target)) {
                    checkboxes.style.display = "none";
                }
                if (checkboxes.contains(e.target)) {
                    checkboxes.style.display = "block";
                }
            });
        }
    </script>
</body>
</html>